services:
  - type: web
    name: hiremebahamas-backend
    env: python
    region: oregon
    plan: free
    # High Availability Configuration
    # For production, upgrade to 'standard' or 'pro' plan for:
    # - Auto-scaling support
    # - Multiple instances
    # - Zero-downtime deploys
    # numInstances: 2  # Uncomment when on paid plan
    autoDeploy: true
    buildCommand: |
      apt-get update
      apt-get install -y --no-install-recommends \
        build-essential \
        gcc \
        g++ \
        make \
        pkg-config \
        cmake \
        autoconf \
        automake \
        libtool \
        postgresql \
        postgresql-client \
        postgresql-client-common \
        postgresql-common \
        postgresql-contrib \
        libpq-dev \
        libpq5 \
        sqlite3 \
        libsqlite3-dev \
        libsqlite3-0 \
        python3-dev \
        python3-setuptools \
        python3-wheel \
        libssl-dev \
        libffi-dev \
        ca-certificates \
        libjpeg-dev \
        libpng-dev \
        libtiff-dev \
        libwebp-dev \
        zlib1g-dev \
        libfreetype6-dev \
        liblcms2-dev \
        libevent-dev \
        libxml2-dev \
        libxslt1-dev \
        libreadline-dev \
        libbz2-dev \
        libncurses5-dev \
        curl \
        wget \
        git
      pip install --upgrade pip setuptools wheel
      pip install -r requirements.txt
    startCommand: gunicorn final_backend_postgresql:application --config gunicorn.conf.py
    envVars:
      - key: FLASK_ENV
        value: production
      - key: ENVIRONMENT
        value: production
      - key: SECRET_KEY
        generateValue: true
      - key: FRONTEND_URL
        value: https://hiremebahamas.vercel.app
      - key: PYTHONUNBUFFERED
        value: "true"
      - key: PYTHON_VERSION
        value: "3.12.0"
      # Gunicorn worker configuration for high availability
      - key: WEB_CONCURRENCY
        value: "2"
      - key: WEB_THREADS
        value: "8"
      - key: GUNICORN_TIMEOUT
        value: "55"
      # DATABASE_URL must be set manually in Render dashboard
      # to connect to your PostgreSQL database
    healthCheckPath: /health
