# Force Python provider only - prevents Node.js detection
providers = ["python"]

[variables]
NIXPACKS_NO_MUSL = "1"
PYTHON_VERSION = "3.12"

[phases.setup]
# Comprehensive system packages for production deployment
aptPkgs = [
    # Build tools (required for compiling Python packages)
    "build-essential",
    "gcc",
    "g++",
    "make",
    # PostgreSQL client and development libraries (for psycopg2)
    "postgresql-client",
    "libpq-dev",
    # SSL/TLS libraries (for cryptography package)
    "libssl-dev",
    "libffi-dev",
    # Image processing libraries (for Pillow if used)
    "libjpeg-dev",
    "libpng-dev",
    "libtiff-dev",
    "libwebp-dev",
    "zlib1g-dev",
    # Event notification library (for gevent)
    "libevent-dev",
    # XML processing libraries (for various packages)
    "libxml2-dev",
    "libxslt1-dev",
    # Redis tools (for connectivity testing)
    "redis-tools",
    # Utilities
    "curl",
    "wget",
    "git"
]

# Secrets should be configured via platform environment variables, NOT in Dockerfile
# Do not use ARG or ENV for: SECRET_KEY, JWT_SECRET_KEY, API keys, passwords, etc.
# Platform services (Railway, Render, etc.) inject secrets at runtime

[start]
# Migration runs automatically in final_backend_postgresql.py
cmd = "gunicorn final_backend_postgresql:application --bind 0.0.0.0:${PORT:-8080} --workers 4 --timeout 120 --access-logfile - --error-logfile -"
