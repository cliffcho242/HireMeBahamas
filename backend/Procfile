# =============================================================================
# HireMeBahamas Procfile - STEP 18: Production Commands (Final)
# =============================================================================
# 
# This Procfile is for Railway/Heroku deployments
# For Render, see render.yaml in the root directory
#
# STEP 18 - PRODUCTION COMMANDS (FINAL):
# - Poetry for consistent dependency management
# - FastAPI for maximum performance with async support
# - Gunicorn with Uvicorn workers for production-grade worker management
# - Configuration centralized in gunicorn.conf.py
# - 4 workers using async event loops = 400+ concurrent connections
# - Redis cache handles most requests (Facebook-level performance)
# - Neon PostgreSQL with connection pooling
#
# Benefits of Poetry + Config File Approach:
# - All dependencies managed in pyproject.toml
# - Deterministic builds with poetry.lock
# - All Gunicorn settings centralized in gunicorn.conf.py
# - Easier maintenance and updates
# - Production-ready configuration
#
# Configuration (from gunicorn.conf.py):
# - workers=4: Four workers for 100K+ concurrent users
# - worker_class=uvicorn.workers.UvicornWorker: ASGI async support
# - timeout=60: Fast responses on always-on service
# - preload_app=False: Safe for database applications
# - Total capacity: 400+ concurrent connections (4 workers Ã— async event loop)
#
# Environment variables (set in platform dashboard):
#   PORT=8000                 Default port
#   WEB_CONCURRENCY=4         Override worker count (optional)
#   DATABASE_URL=postgresql://...  Neon PostgreSQL connection string
#   SECRET_KEY=...            Generated secret key
#   JWT_SECRET_KEY=...        Generated JWT secret
#   ENVIRONMENT=production    Production mode
#   REDIS_URL=...            Redis connection string (optional)
# 
# Expected Performance:
# - Feed: 20-60ms (with Redis caching)
# - Auth: <50ms
# - Health: <30ms
# - DB load: Very low (Redis handles most requests)
# - Concurrent capacity: 400+ connections
# - Supported users: 100K+ concurrent
# =============================================================================

# Main web process - Optimized Gunicorn for Render (AGGRESSIVE FOREVER FIX)
# Note: When using this Procfile, ensure the working directory is 'backend/'
# Railway/Heroku should have root directory set to 'backend/' in settings
# If root is the project root, use: cd backend && poetry run gunicorn ...
# 
# CRITICAL SETTINGS FOR RENDER:
# - workers=1: Single worker for small instances (faster + safer)
# - threads=2: Minimal threading overhead
# - timeout=120: Prevents worker SIGTERM during slow startup
# - graceful_timeout=30: Clean shutdown
# - keepalive=5: Connection persistence
# - log-level=info: Production logging
# 
# Configuration file (gunicorn.conf.py) provides additional settings
web: poetry run gunicorn app.main:app --workers 1 --threads 2 --timeout 120 --graceful-timeout 30 --keep-alive 5 --log-level info --config gunicorn.conf.py