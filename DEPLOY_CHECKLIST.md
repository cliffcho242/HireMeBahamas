# ðŸš€ NUCLEAR 2025-PROOF DEPLOYMENT CHECKLIST

## 8-Step Deploy Checklist (ORDER MATTERS)

### Step 1: Railway PostgreSQL Configuration
```bash
# In Railway Dashboard â†’ PostgreSQL Service â†’ Variables, add:
PGDATA=/var/lib/postgresql/data
POSTGRES_INITDB_ARGS=--data-checksums

# In Railway Dashboard â†’ PostgreSQL Service â†’ Settings, set:
# shared_preload_libraries is not needed - jit=off is set per-connection
```

### Step 2: Set DATABASE_URL with Nuclear Parameters
```bash
# In Railway Dashboard â†’ Backend Service â†’ Variables, set:
# Use private networking (cheaper, faster):
DATABASE_URL=postgresql://user:pass@postgres.railway.internal:5432/railway?connect_timeout=10&options=-c%20jit%3Doff

# OR use public URL if private networking unavailable:
DATABASE_URL=postgresql://user:pass@host.railway.app:port/railway?sslmode=require&connect_timeout=10&options=-c%20jit%3Doff
```

### Step 3: Set Backend Environment Variables
```bash
# In Railway Dashboard â†’ Backend Service â†’ Variables:
SECRET_KEY=<auto-generated-256-bit-key>
FRONTEND_URL=https://hiremebahamas.vercel.app
ENVIRONMENT=production
WEB_CONCURRENCY=1
WEB_THREADS=4
GUNICORN_TIMEOUT=120
PRELOAD_APP=true
PYTHONUNBUFFERED=true
```

### Step 4: Deploy Backend to Railway
```bash
# Push to trigger Railway auto-deploy:
git push origin main
```

### Step 5: Configure Render Web Service (if using Render)
```bash
# Render Dashboard â†’ Web Service â†’ Settings:
Plan: Standard ($25/mo)
Health Check Path: /health
Health Check Timeout: 30 seconds
Grace Period: 300 seconds
Instance Memory: 1GB
```

### Step 6: Deploy Keep-Alive Worker to Render
```bash
# Render Dashboard â†’ New â†’ Background Worker:
Name: keep-alive
Runtime: Python 3
Build Command: pip install requests
Start Command: python keep_alive.py
Plan: Free
```

### Step 7: Verify Health Endpoints
```bash
# Test instant health response:
curl -w "@curl-format.txt" -o /dev/null -s https://hiremebahamas.onrender.com/health
# Expected: < 50ms response time

# Test ready endpoint:
curl https://hiremebahamas.onrender.com/ready
# Expected: {"status": "ready", "timestamp": ...}

# Test database readiness:
curl https://hiremebahamas.onrender.com/ready/db
# Expected: {"status": "ready", "database": "connected"}
```

### Step 8: Verify Login Performance
```bash
# Test login (should be < 180ms):
time curl -X POST https://hiremebahamas.onrender.com/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@test.com","password":"test123"}'
# Expected: < 180ms for cached users
```

---

## Performance Targets After Deployment

| Metric | Target | Actual |
|--------|--------|--------|
| Boot time | < 9 seconds | _____ |
| Health response | < 5ms | _____ |
| First request | < 400ms | _____ |
| Login (cached) | < 180ms | _____ |
| 502 errors | 0 | _____ |
| 499 errors | 0 | _____ |
| OOM kills | 0 | _____ |
| Monthly cost | < $60 | _____ |

---

## Final Configuration Summary

### DATABASE_URL (Private Networking)
```
postgresql://user:pass@postgres.railway.internal:5432/railway?connect_timeout=10&options=-c%20jit%3Doff
```

### Gunicorn Start Command
```bash
gunicorn final_backend_postgresql:application --config gunicorn.conf.py --preload
```

### Render Dashboard Settings
- Plan: Standard ($25/mo)
- Health Check Path: `/health`
- Health Check Timeout: 30 seconds
- Grace Period: 300 seconds

### Railway PostgreSQL Variables
- No special variables needed - `jit=off` is set per-connection in DATABASE_URL

---

## Troubleshooting

### 502 Bad Gateway
1. Check `/health` endpoint responds
2. Verify `GUNICORN_TIMEOUT=120`
3. Ensure `WEB_CONCURRENCY=1`

### Slow Login (> 180ms)
1. Verify `jit=off` in DATABASE_URL
2. Check Redis cache is connected
3. Pre-warm bcrypt on startup

### OOM Kills
1. Set `WEB_CONCURRENCY=1`
2. Set `GUNICORN_MAX_REQUESTS=500`
3. Upgrade to Standard plan (1GB RAM)

### Cold Start Timeouts
1. Deploy keep-alive worker
2. Verify `preload=true`
3. Check `/health` is instant (no DB)
