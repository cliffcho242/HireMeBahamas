# HireMeBahamas Environment Variables
# IMPORTANT: Copy this file to .env and update the values
#
# ‚ö†Ô∏è DEPLOYING TO VERCEL? READ THIS FIRST:
# üìñ VERCEL_ENV_LOCK.md - MANDATORY rules for frontend environment variables
# üö´ No backend secrets (DATABASE_URL, JWT_SECRET) with VITE_ prefix
# üö´ No DATABASE_URL in Vercel frontend environment
# üö´ No localhost URLs in production

# =============================================================================
# SECURITY: SECRET KEYS (CRITICAL - READ BEFORE DEPLOYING)
# =============================================================================
# Secret keys for JWT authentication and session management
#
# ‚ö†Ô∏è  CRITICAL SECURITY REQUIREMENTS:
# 1. NEVER use the default values below in production
# 2. Generate unique random secrets (minimum 32 characters)
# 3. Use different secrets for each environment (dev/staging/prod)
# 4. Store secrets securely (never commit .env to git)
# 5. DO NOT CHANGE SECRET_KEY after production deployment (invalidates sessions)
#
# Generate secure secrets with one of these commands:
#   python3 -c "import secrets; print(secrets.token_urlsafe(32))"
#   openssl rand -base64 32
#   node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
#
# See SECURITY.md for detailed guidelines
# See SECURITY_CHECKLIST.md before deploying to production
#
SECRET_KEY=your-secret-key-here-generate-a-random-one
JWT_SECRET_KEY=your-jwt-secret-key-here-generate-a-random-one

# Cron Job Security
# Secret used to authorize cron job requests from Vercel
# Vercel automatically sends this in the Authorization header as "Bearer {CRON_SECRET}"
# Generate a secure random secret (minimum 32 characters) using one of the commands above
# IMPORTANT: Add this as an environment variable in your Vercel project settings
CRON_SECRET=your-cron-secret-here-generate-a-random-one

# Token expiration configuration (in days)
TOKEN_EXPIRATION_DAYS=7

# Bcrypt rounds for password hashing (default: 10)
# Higher values are more secure but slower (each increment doubles time)
# Recommended: 10-12 for production (10 = ~60ms, 12 = ~240ms per operation)
# BCRYPT_ROUNDS=10

# Login request timeout (in seconds, default: 25)
# Maximum time allowed for a login request before returning a timeout error
# This helps prevent HTTP 499 errors by returning a proper response before
# the client or load balancer times out (typically 30 seconds)
# LOGIN_REQUEST_TIMEOUT_SECONDS=25

# =============================================================================
# SECURITY: DATABASE CONFIGURATION (SSL/TLS REQUIRED IN PRODUCTION)
# =============================================================================
# ‚ö†Ô∏è  IMPORTANT: PostgreSQL is REQUIRED for production deployments
# ‚ö†Ô∏è  SQLite is only for local development and will NOT persist data in production
#
# üîí SECURITY REQUIREMENT: All production database connections MUST use SSL/TLS
#    - Include ?sslmode=require in DATABASE_URL
#    - Never use sslmode=disable or sslmode=prefer in production
#    - Application automatically enforces SSL for cloud databases
#
# See SECURITY.md for detailed database security guidelines
# See SECURITY_CHECKLIST.md for production deployment validation
#
# =============================================================================
# DATABASE CONFIGURATION - NEON POSTGRESQL (REQUIRED)
# =============================================================================
# ‚ö†Ô∏è  IMPORTANT: Only DATABASE_URL is supported (PGHOST, PGUSER, PGPASSWORD, PGDATABASE are NOT supported)
#
# NEON DATABASE FORMAT (Recommended):
# DATABASE_URL=postgresql://USER:ENCODED_PASSWORD@ep-xxxxx.REGION.aws.neon.tech:5432/DB_NAME?sslmode=require
#
# üîí SECURITY REQUIREMENT: MUST include ?sslmode=require for SSL/TLS encryption
#
# Get your connection string from your database provider:
# - Neon: https://console.neon.tech/ ‚Üí Your Project ‚Üí Connection Details
# - Railway: Railway Dashboard ‚Üí PostgreSQL ‚Üí Connect ‚Üí Copy Connection String
# - Vercel Postgres: Vercel Dashboard ‚Üí Storage ‚Üí Postgres ‚Üí .env.local tab
# - Render: Render Dashboard ‚Üí Database ‚Üí Connection String
#
# ‚ö†Ô∏è  IMPORTANT: Copy your ACTUAL connection string from your database provider's dashboard!
#     Do NOT manually type placeholders - use the "Copy" button
#     Do NOT wrap in quotes - paste the URL directly
#
# Example format (your actual URL will have different values):
# DATABASE_URL=postgresql://default:ABCxyz123@ep-cool-sound-12345.us-east-1.aws.neon.tech:5432/verceldb?sslmode=require
DATABASE_URL=
#
# For local development, you can use a local PostgreSQL database:
# DATABASE_URL=postgresql://hiremebahamas_user:hiremebahamas_password@localhost:5432/hiremebahamas
#

# TCP Connection Settings (for PostgreSQL)
# These settings help prevent "SSL error: unexpected eof while reading" errors
# by detecting and handling stale connections before they cause SSL errors.
#
# TCP_KEEPALIVE_ENABLED: Enable TCP keepalive (default: 1 = enabled)
# TCP_KEEPALIVE_IDLE: Seconds before sending keepalive probes (default: 20)
# TCP_KEEPALIVE_INTERVAL: Seconds between keepalive probes (default: 5)
# TCP_KEEPALIVE_COUNT: Number of failed probes before marking connection dead (default: 3)
# TCP_USER_TIMEOUT_MS: Abort if data isn't acknowledged within this time (default: 20000ms)
#
# Total detection time = idle + (interval * count) = 20 + (5 * 3) = 35 seconds
# TCP_KEEPALIVE_ENABLED=1
# TCP_KEEPALIVE_IDLE=20
# TCP_KEEPALIVE_INTERVAL=5
# TCP_KEEPALIVE_COUNT=3
# TCP_USER_TIMEOUT_MS=20000

# =============================================================================
# RAILWAY/RENDER POSTGRES CONNECTION SETTINGS
# =============================================================================
# These settings are optimized for connecting to PostgreSQL from Render to Railway
# or other cross-cloud deployments that may have network latency or IPv6 issues.
#
# =============================================================================
# TOP 3 TIMEOUT FIXES (these address 99% of cloud PostgreSQL timeout issues)
# =============================================================================
#
# 1. DB_CONNECT_TIMEOUT: Connection establishment timeout in seconds (default: 5)
#    - Maximum time to wait for TCP connection and PostgreSQL handshake
#    - Cloud databases need appropriate timeout (5s) due to network latency and cold starts
#    - This is the #1 cause of timeout errors in cloud deployments
#    - Railway PostgreSQL requires 5s for cold starts and private network connections
# DB_CONNECT_TIMEOUT=5
#
# 2. JIT (Just-In-Time) Compilation: Automatically disabled via options=-c jit=off
#    - PostgreSQL's JIT compiler causes significant first-query delays
#    - Can cause unexpected timeouts on the first execution of complex queries
#    - The backend automatically sets jit=off in connection options
#
# 3. SSL Mode: Automatically set to 'require' for cloud databases
#    - Cloud databases require SSL for security
#    - Using 'require' ensures encrypted connections work correctly
#    - sslmode=require is the default when DATABASE_URL doesn't specify otherwise
#
# =============================================================================
#
# STATEMENT_TIMEOUT_MS: Query execution timeout in milliseconds (default: 30000)
#   - Applied server-side via PostgreSQL options
#   - Prevents long-running queries from blocking connections
# STATEMENT_TIMEOUT_MS=30000
#
# DB_FORCE_IPV4: Force IPv4 connections (default: true)
#   - Railway/Render sometimes have IPv6 connectivity issues
#   - Set to false only if you have confirmed IPv6 works in your setup
# DB_FORCE_IPV4=true

# Environment (set to "production" or "prod" in production deployments)
# ENVIRONMENT=production

# Server Configuration
PORT=5000

# Backend URL Configuration
# Set this to your backend API URL for external services and health checks
# Examples:
#   Development:  BACKEND_URL=http://localhost:8000
#   Railway:      BACKEND_URL=https://hiremebahamas-backend.railway.app
#   Vercel:       BACKEND_URL=https://hiremebahamas.vercel.app
#   Render:       BACKEND_URL=https://hiremebahamas.onrender.com
BACKEND_URL=http://localhost:8000

# CORS Settings
FRONTEND_URL=https://hiremebahamas.vercel.app

# OAuth Configuration (Optional - for Google and Apple Sign-In)
# Get Google Client ID from: https://console.cloud.google.com/apis/credentials
# GOOGLE_CLIENT_ID=your_google_client_id_here
# Get Apple Client ID from: https://developer.apple.com/account/resources/identifiers/list/serviceId
# APPLE_CLIENT_ID=com.hiremebahamas.signin

# SonarCloud Configuration (Optional - for code quality analysis)
# Generate a token at: https://sonarcloud.io/account/security/
# Add this as a GitHub repository secret named SONAR_TOKEN at:
# https://github.com/cliffcho242/HireMeBahamas/settings/secrets/actions
# SONAR_TOKEN=your-sonarcloud-token-here

# =============================================================================
# MONITORING & ERROR TRACKING
# =============================================================================

# Sentry Configuration (Error Tracking)
# Get your DSN from: https://sentry.io/ after creating a project
# SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id

# Sentry environment name (automatically set based on ENVIRONMENT if not specified)
# SENTRY_ENVIRONMENT=production

# Frontend Sentry Configuration (React Error Tracking)
# Get your DSN from: https://sentry.io/ after creating a React project
# This is used by the frontend to track runtime errors, crashes, and performance
# VITE_SENTRY_DSN=https://your-frontend-sentry-dsn@sentry.io/project-id
#
# Note: VITE_ prefix is required for Vite to expose the variable to the frontend
# Leave empty to disable Sentry in development
#
# Traces sample rate (0.0 to 1.0): Controls performance monitoring
# - 0.2 = 20% of transactions are sent to Sentry (default)
# - 1.0 = 100% for debugging (not recommended in production)
# - 0.0 = Disable performance monitoring
# VITE_SENTRY_TRACES_SAMPLE_RATE=0.2

# =============================================================================
# RATE LIMITING CONFIGURATION
# =============================================================================
# Protection against brute force attacks and API abuse
#
# üîí SECURITY: Rate limiting is CRITICAL for authentication endpoints
#
# Current implementation (in-memory):
#   - Login: 5 attempts per 15 minutes (per IP or email)
#   - Lockout duration: 15 minutes after exceeding limit
#
# Configuration (optional overrides):
# MAX_LOGIN_ATTEMPTS=5              # Number of failed attempts before lockout
# RATE_LIMIT_LOCKOUT_MINUTES=15    # How long to block after exceeding limit
#
# üìù Production Recommendations:
#   - For multi-instance deployments, use Redis for distributed rate limiting
#   - Add CAPTCHA after N failed attempts
#   - Monitor rate limit violations in logs
#   - Consider implementing sliding window algorithm
#
# See SECURITY.md for detailed rate limiting guidelines
# See backend/app/api/auth.py for current implementation
#
# For distributed rate limiting with Redis:
# REDIS_URL=redis://localhost:6379
# RATE_LIMIT_STORAGE=redis  # Options: memory (default), redis
#
# =============================================================================
# REDIS CACHE CONFIGURATION (OPTIONAL - RECOMMENDED FOR PRODUCTION)
# =============================================================================
# Redis provides significant performance improvements and scalability benefits:
#
# üöÄ BENEFITS:
#   - 90% faster authentication (10ms ‚Üí <1ms)
#   - 80-90% reduction in database load
#   - Shared cache across multiple instances
#   - Session persistence across restarts
#   - Handle 10x more users without database upgrades
#
# ‚ö° PERFORMANCE TARGETS:
#   - Cache hit latency: <1ms
#   - Feed load time: <100ms
#   - Database query reduction: 80-90%
#   - Concurrent users: 100K+
#
# üì¶ SETUP:
# 1. Choose a Redis provider:
#    - Upstash Redis (Recommended - Free tier available)
#    - Railway Redis (One-click deployment)
#    - Render Redis (Free tier: 25MB)
#
# 2. Get your Redis URL from provider dashboard
# 3. Set REDIS_URL below (local dev) or in deployment platform
#
# üîí SECURITY:
#   - Always use rediss:// (SSL/TLS) in production
#   - Never commit Redis passwords to git
#   - Use environment variables for credentials
#
# FORMAT:
#   Development:  redis://localhost:6379
#   Production:   rediss://:password@hostname:port
#
# EXAMPLE:
#   REDIS_URL=rediss://:abc123xyz@global.upstash.io:6379
#
# The application automatically detects Redis and uses it when available.
# If REDIS_URL is not set, the application falls back to in-memory cache.
#
# See REDIS_SETUP_GUIDE.md for detailed setup instructions
# See REDIS_CACHING_README.md for architecture and usage
# =============================================================================
# REDIS_URL=redis://localhost:6379
#
# Alternative Redis URLs (checked in order of priority):
# REDIS_PRIVATE_URL=rediss://:password@hostname:port
# UPSTASH_REDIS_REST_URL=rediss://:password@hostname:port

# Cache timeout configuration (in seconds)
# CACHE_DEFAULT_TIMEOUT=300
# CACHE_TIMEOUT_JOBS=60
# CACHE_TIMEOUT_POSTS=30
# CACHE_TIMEOUT_USERS=120

# Slow request threshold (in milliseconds)
# Requests exceeding this are logged with warnings
# SLOW_REQUEST_THRESHOLD_MS=3000

# =============================================================================
# MONITORING ENDPOINTS
# =============================================================================
# The following endpoints are available for monitoring:
# - /health         - Quick health check (no DB access)
# - /health/ping    - Ultra-fast ping (returns "pong")
# - /api/health     - Detailed health with database status
# - /metrics        - Prometheus metrics (text format)
# - /api/database/ping - Database keepalive ping

# =============================================================================
# EXTENSION CLEANUP CONFIGURATION
# =============================================================================
# These settings control how the application handles orphaned PostgreSQL
# extensions like pg_stat_statements that can't function on Railway's managed
# PostgreSQL (which lacks shared_preload_libraries access).

# SUPPRESS_EXTENSION_CLEANUP_WARNINGS: Suppress transient connection errors during cleanup
# Set to "true" to hide "Periodic extension cleanup failed" warnings when the database
# connection times out. These warnings are harmless since the cleanup is non-critical.
# Default: true
# SUPPRESS_EXTENSION_CLEANUP_WARNINGS=true

# DISABLE_EXTENSION_CLEANUP: Completely disable periodic extension cleanup
# Set to "true" to stop all periodic extension cleanup attempts.
# The initial cleanup at startup will still run once to set up the dummy view.
# Default: false
# DISABLE_EXTENSION_CLEANUP=false

# CREATE_DUMMY_PG_STAT_STATEMENTS: Create dummy view for Railway monitoring
# Set to "true" to create an empty pg_stat_statements view that satisfies
# Railway's monitoring queries without errors.
# Default: true
# CREATE_DUMMY_PG_STAT_STATEMENTS=true

# DB_EXTENSION_CLEANUP_INTERVAL_SECONDS: How often to run periodic cleanup
# Cleanup runs after this many seconds since the last cleanup.
# Set to a very high value (e.g., 999999999) to effectively disable periodic cleanup.
# Default: 3600 (1 hour)
# DB_EXTENSION_CLEANUP_INTERVAL_SECONDS=3600
