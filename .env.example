# HireMeBahamas Environment Variables
# IMPORTANT: Copy this file to .env and update the values

# =============================================================================
# SECURITY: SECRET KEYS (CRITICAL - READ BEFORE DEPLOYING)
# =============================================================================
# Secret keys for JWT authentication and session management
#
# ‚ö†Ô∏è  CRITICAL SECURITY REQUIREMENTS:
# 1. NEVER use the default values below in production
# 2. Generate unique random secrets (minimum 32 characters)
# 3. Use different secrets for each environment (dev/staging/prod)
# 4. Store secrets securely (never commit .env to git)
# 5. DO NOT CHANGE SECRET_KEY after production deployment (invalidates sessions)
#
# Generate secure secrets with one of these commands:
#   python3 -c "import secrets; print(secrets.token_urlsafe(32))"
#   openssl rand -base64 32
#   node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
#
# See SECURITY.md for detailed guidelines
# See SECURITY_CHECKLIST.md before deploying to production
#
SECRET_KEY=your-secret-key-here-generate-a-random-one
JWT_SECRET_KEY=your-jwt-secret-key-here-generate-a-random-one

# Token expiration configuration (in days)
TOKEN_EXPIRATION_DAYS=7

# Bcrypt rounds for password hashing (default: 10)
# Higher values are more secure but slower (each increment doubles time)
# Recommended: 10-12 for production (10 = ~60ms, 12 = ~240ms per operation)
# BCRYPT_ROUNDS=10

# Login request timeout (in seconds, default: 25)
# Maximum time allowed for a login request before returning a timeout error
# This helps prevent HTTP 499 errors by returning a proper response before
# the client or load balancer times out (typically 30 seconds)
# LOGIN_REQUEST_TIMEOUT_SECONDS=25

# =============================================================================
# SECURITY: DATABASE CONFIGURATION (SSL/TLS REQUIRED IN PRODUCTION)
# =============================================================================
# ‚ö†Ô∏è  IMPORTANT: PostgreSQL is REQUIRED for production deployments
# ‚ö†Ô∏è  SQLite is only for local development and will NOT persist data in production
#
# üîí SECURITY REQUIREMENT: All production database connections MUST use SSL/TLS
#    - Include ?sslmode=require in DATABASE_URL
#    - Never use sslmode=disable or sslmode=prefer in production
#    - Application automatically enforces SSL for cloud databases
#
# See SECURITY.md for detailed database security guidelines
# See SECURITY_CHECKLIST.md for production deployment validation
#
# =============================================================================
# REQUIRED VARIABLES FOR RAILWAY DEPLOYMENT
# =============================================================================
# Your Railway deployment MUST have one of the following configurations:
#
# OPTION A (Recommended): Use DATABASE_URL
#   - Set DATABASE_PRIVATE_URL (best - no egress fees) OR
#   - Set DATABASE_URL (public connection) OR  
#   - Set POSTGRES_URL (Vercel Postgres compatibility)
#
# OPTION B (Fallback): Use Individual PostgreSQL Variables
#   - Set ALL of: PGHOST, PGPORT, PGUSER, PGPASSWORD, PGDATABASE
#
# =============================================================================
# OPTION 1: Railway Postgres (RECOMMENDED - Current Deployment)
# =============================================================================
# Railway PostgreSQL is the recommended database for HireMeBahamas deployments
# - Free tier: 512MB RAM, 1GB storage
# - Automatic backups and high availability
# - Private networking for zero egress fees
# - Setup guide: RAILWAY_DATABASE_SETUP.md
# - Quick fix guide: RAILWAY_DATABASE_DEPLOYMENT_GUIDE.md
#
# For Railway deployments, use DATABASE_PRIVATE_URL to avoid egress fees:
# DATABASE_PRIVATE_URL is automatically provided by Railway and uses the internal
# private network instead of the public TCP proxy, avoiding egress charges.
# üîí SECURITY: Add ?sslmode=require to enforce SSL/TLS encryption
# ‚ö†Ô∏è  IMPORTANT: Copy your ACTUAL connection string from Railway Dashboard!
#     Do NOT manually type placeholders - copy the entire URL from Railway
#     Railway Dashboard ‚Üí PostgreSQL ‚Üí Connect ‚Üí Copy Connection String
# Example format:
# DATABASE_PRIVATE_URL=postgresql://postgres:ABCxyz123@containers-us-west-123.railway.internal:5432/railway?sslmode=require
DATABASE_PRIVATE_URL=
#
# For external connections to Railway (e.g., from Vercel), use DATABASE_URL:
# Get your connection string from: Railway Dashboard ‚Üí Your Project ‚Üí PostgreSQL ‚Üí Connect
# üîí SECURITY: MUST include ?sslmode=require for encrypted connections
# ‚ö†Ô∏è  IMPORTANT: Copy your ACTUAL connection string from Railway Dashboard!
#     Do NOT manually type placeholders - copy the entire URL from Railway
# Example format:
# DATABASE_URL=postgresql://postgres:ABCxyz123@containers-us-west-123.railway.app:5432/railway?sslmode=require
DATABASE_URL=
#
# Alternative: Individual PostgreSQL Variables (if DATABASE_URL not available)
# Extract these from your DATABASE_URL or Railway PostgreSQL service:
# PGHOST=containers-us-west-XX.railway.app  # or postgres.railway.internal for private network
# PGPORT=5432
# PGUSER=postgres
# PGPASSWORD=your_password_here
# PGDATABASE=railway
#
# =============================================================================
# OPTION 2: Vercel Postgres (Good for Vercel-only deployments)
# =============================================================================
# Vercel Postgres is powered by Neon and optimized for serverless deployments
# - Free tier: 0.5 GB storage (Hobby plan)
# - Pro tier: $0.10/GB/month with autoscaling
# - Setup guide: VERCEL_POSTGRES_SETUP.md
#
# üîí SECURITY REQUIREMENT: Vercel Postgres (Neon) REQUIRES SSL connections
# The connection string MUST include ?sslmode=require
#
# Get your connection string from: Vercel Dashboard ‚Üí Storage ‚Üí Postgres ‚Üí .env.local tab
# NEON Format: postgresql://default:PASSWORD@ep-xxxxx.REGION.aws.neon.tech:5432/verceldb?sslmode=require
#
# ‚úî Real hostname: ep-xxxxx.us-east-1.aws.neon.tech (example)
# ‚úî Port: :5432
# ‚úî SSL: ?sslmode=require
# ‚úî No spaces
# ‚úî No quotes
#
# üîí SSL enforcement:
#    - The application automatically adds ?sslmode=require if missing
#    - For production, explicitly include it in DATABASE_URL for clarity
#    - CI/CD checks validate SSL is enabled before deployment
#
# ‚ö†Ô∏è  IMPORTANT: Copy your ACTUAL connection string from Vercel Dashboard!
#     Do NOT manually type - click "Copy" in the .env.local tab
#     Do NOT wrap in quotes - paste the URL directly
#     Example format (your actual URL will have different values):
# DATABASE_URL=postgresql://default:ABCxyz123@ep-cool-sound-12345.us-east-1.aws.neon.tech:5432/verceldb?sslmode=require
#
# =============================================================================
# OPTION 3: Other Managed Postgres (Render, Supabase, etc.) - LEGACY
# =============================================================================
# ‚ö†Ô∏è  If migrating from Render: Update DATABASE_URL to point to Railway instead
# ‚ö†Ô∏è  Render PostgreSQL may cause connectivity issues including:
# ‚ö†Ô∏è    - SSL EOF errors ("SSL error: unexpected eof while reading")
# ‚ö†Ô∏è    - Connection timeouts and dropped connections
# ‚ö†Ô∏è    - Intermittent authentication failures preventing user sign-in
# ‚ö†Ô∏è  See RENDER_TO_RAILWAY_MIGRATION.md for complete migration guide
#
# For other platforms (Render, Supabase, etc.), set DATABASE_URL to PostgreSQL connection string:
# ‚ö†Ô∏è  IMPORTANT: Copy your ACTUAL connection string from your database provider's dashboard!
#     Do NOT manually type placeholders - use the "Copy" button in your dashboard
#     Ensure it includes: hostname, port (:5432), and ?sslmode=require
# Example formats:
# Render: postgresql://user:ABCxyz123@dpg-abc123.oregon-postgres.render.com:5432/mydb?sslmode=require
# Supabase: postgresql://postgres:ABCxyz123@db.abc123.supabase.co:5432/postgres?sslmode=require
# DATABASE_URL=
#
# Priority: DATABASE_PRIVATE_URL > POSTGRES_URL > DATABASE_URL > Individual PG* vars > local default
#
# For local development only, you can comment out both URLs to use SQLite:
# (Uncomment the line below to use SQLite for local dev)
# DATABASE_URL=

# TCP Connection Settings (for PostgreSQL)
# These settings help prevent "SSL error: unexpected eof while reading" errors
# by detecting and handling stale connections before they cause SSL errors.
#
# TCP_KEEPALIVE_ENABLED: Enable TCP keepalive (default: 1 = enabled)
# TCP_KEEPALIVE_IDLE: Seconds before sending keepalive probes (default: 20)
# TCP_KEEPALIVE_INTERVAL: Seconds between keepalive probes (default: 5)
# TCP_KEEPALIVE_COUNT: Number of failed probes before marking connection dead (default: 3)
# TCP_USER_TIMEOUT_MS: Abort if data isn't acknowledged within this time (default: 20000ms)
#
# Total detection time = idle + (interval * count) = 20 + (5 * 3) = 35 seconds
# TCP_KEEPALIVE_ENABLED=1
# TCP_KEEPALIVE_IDLE=20
# TCP_KEEPALIVE_INTERVAL=5
# TCP_KEEPALIVE_COUNT=3
# TCP_USER_TIMEOUT_MS=20000

# =============================================================================
# RAILWAY/RENDER POSTGRES CONNECTION SETTINGS
# =============================================================================
# These settings are optimized for connecting to PostgreSQL from Render to Railway
# or other cross-cloud deployments that may have network latency or IPv6 issues.
#
# =============================================================================
# TOP 3 TIMEOUT FIXES (these address 99% of cloud PostgreSQL timeout issues)
# =============================================================================
#
# 1. DB_CONNECT_TIMEOUT: Connection establishment timeout in seconds (default: 45)
#    - Maximum time to wait for TCP connection and PostgreSQL handshake
#    - Cloud databases need higher timeout (45s) due to network latency and cold starts
#    - This is the #1 cause of timeout errors in cloud deployments
#    - Railway PostgreSQL requires 45s for cold starts and private network connections
# DB_CONNECT_TIMEOUT=45
#
# 2. JIT (Just-In-Time) Compilation: Automatically disabled via options=-c jit=off
#    - PostgreSQL's JIT compiler causes significant first-query delays
#    - Can cause unexpected timeouts on the first execution of complex queries
#    - The backend automatically sets jit=off in connection options
#
# 3. SSL Mode: Automatically set to 'require' for cloud databases
#    - Cloud databases require SSL for security
#    - Using 'require' ensures encrypted connections work correctly
#    - sslmode=require is the default when DATABASE_URL doesn't specify otherwise
#
# =============================================================================
#
# STATEMENT_TIMEOUT_MS: Query execution timeout in milliseconds (default: 30000)
#   - Applied server-side via PostgreSQL options
#   - Prevents long-running queries from blocking connections
# STATEMENT_TIMEOUT_MS=30000
#
# DB_FORCE_IPV4: Force IPv4 connections (default: true)
#   - Railway/Render sometimes have IPv6 connectivity issues
#   - Set to false only if you have confirmed IPv6 works in your setup
# DB_FORCE_IPV4=true

# Environment (set to "production" or "prod" in production deployments)
# ENVIRONMENT=production

# Server Configuration
PORT=5000

# Backend URL Configuration
# Set this to your backend API URL for external services and health checks
# Examples:
#   Development:  BACKEND_URL=http://localhost:8000
#   Railway:      BACKEND_URL=https://hiremebahamas-backend.railway.app
#   Vercel:       BACKEND_URL=https://hiremebahamas.vercel.app
#   Render:       BACKEND_URL=https://hiremebahamas.onrender.com
BACKEND_URL=http://localhost:8000

# CORS Settings
FRONTEND_URL=https://hiremebahamas.vercel.app

# OAuth Configuration (Optional - for Google and Apple Sign-In)
# Get Google Client ID from: https://console.cloud.google.com/apis/credentials
# GOOGLE_CLIENT_ID=your_google_client_id_here
# Get Apple Client ID from: https://developer.apple.com/account/resources/identifiers/list/serviceId
# APPLE_CLIENT_ID=com.hiremebahamas.signin

# SonarCloud Configuration (Optional - for code quality analysis)
# Generate a token at: https://sonarcloud.io/account/security/
# Add this as a GitHub repository secret named SONAR_TOKEN at:
# https://github.com/cliffcho242/HireMeBahamas/settings/secrets/actions
# SONAR_TOKEN=your-sonarcloud-token-here

# =============================================================================
# MONITORING & ERROR TRACKING
# =============================================================================

# Sentry Configuration (Error Tracking)
# Get your DSN from: https://sentry.io/ after creating a project
# SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id

# Sentry environment name (automatically set based on ENVIRONMENT if not specified)
# SENTRY_ENVIRONMENT=production

# =============================================================================
# RATE LIMITING CONFIGURATION
# =============================================================================
# Protection against brute force attacks and API abuse
#
# üîí SECURITY: Rate limiting is CRITICAL for authentication endpoints
#
# Current implementation (in-memory):
#   - Login: 5 attempts per 15 minutes (per IP or email)
#   - Lockout duration: 15 minutes after exceeding limit
#
# Configuration (optional overrides):
# MAX_LOGIN_ATTEMPTS=5              # Number of failed attempts before lockout
# RATE_LIMIT_LOCKOUT_MINUTES=15    # How long to block after exceeding limit
#
# üìù Production Recommendations:
#   - For multi-instance deployments, use Redis for distributed rate limiting
#   - Add CAPTCHA after N failed attempts
#   - Monitor rate limit violations in logs
#   - Consider implementing sliding window algorithm
#
# See SECURITY.md for detailed rate limiting guidelines
# See backend/app/api/auth.py for current implementation
#
# For distributed rate limiting with Redis:
# REDIS_URL=redis://localhost:6379
# RATE_LIMIT_STORAGE=redis  # Options: memory (default), redis
#
# =============================================================================
# Used by Flask-Caching for distributed caching in production
# Falls back to simple in-memory cache if not configured
# REDIS_URL=redis://localhost:6379

# Cache timeout configuration (in seconds)
# CACHE_DEFAULT_TIMEOUT=300
# CACHE_TIMEOUT_JOBS=60
# CACHE_TIMEOUT_POSTS=30
# CACHE_TIMEOUT_USERS=120

# Slow request threshold (in milliseconds)
# Requests exceeding this are logged with warnings
# SLOW_REQUEST_THRESHOLD_MS=3000

# =============================================================================
# MONITORING ENDPOINTS
# =============================================================================
# The following endpoints are available for monitoring:
# - /health         - Quick health check (no DB access)
# - /health/ping    - Ultra-fast ping (returns "pong")
# - /api/health     - Detailed health with database status
# - /metrics        - Prometheus metrics (text format)
# - /api/database/ping - Database keepalive ping

# =============================================================================
# EXTENSION CLEANUP CONFIGURATION
# =============================================================================
# These settings control how the application handles orphaned PostgreSQL
# extensions like pg_stat_statements that can't function on Railway's managed
# PostgreSQL (which lacks shared_preload_libraries access).

# SUPPRESS_EXTENSION_CLEANUP_WARNINGS: Suppress transient connection errors during cleanup
# Set to "true" to hide "Periodic extension cleanup failed" warnings when the database
# connection times out. These warnings are harmless since the cleanup is non-critical.
# Default: true
# SUPPRESS_EXTENSION_CLEANUP_WARNINGS=true

# DISABLE_EXTENSION_CLEANUP: Completely disable periodic extension cleanup
# Set to "true" to stop all periodic extension cleanup attempts.
# The initial cleanup at startup will still run once to set up the dummy view.
# Default: false
# DISABLE_EXTENSION_CLEANUP=false

# CREATE_DUMMY_PG_STAT_STATEMENTS: Create dummy view for Railway monitoring
# Set to "true" to create an empty pg_stat_statements view that satisfies
# Railway's monitoring queries without errors.
# Default: true
# CREATE_DUMMY_PG_STAT_STATEMENTS=true

# DB_EXTENSION_CLEANUP_INTERVAL_SECONDS: How often to run periodic cleanup
# Cleanup runs after this many seconds since the last cleanup.
# Set to a very high value (e.g., 999999999) to effectively disable periodic cleanup.
# Default: 3600 (1 hour)
# DB_EXTENSION_CLEANUP_INTERVAL_SECONDS=3600
