# HireMeBahamas Environment Variables
# IMPORTANT: Copy this file to .env and update the values

# Secret keys for JWT authentication
# CRITICAL: DO NOT CHANGE SECRET_KEY after production deployment
# Changing it will invalidate all existing user sessions!
# Generate a new secret key with: python3 -c "import secrets; print(secrets.token_urlsafe(32))"
SECRET_KEY=your-secret-key-here-generate-a-random-one
JWT_SECRET_KEY=your-jwt-secret-key-here-generate-a-random-one

# Token expiration configuration (in days)
TOKEN_EXPIRATION_DAYS=7

# Bcrypt rounds for password hashing (default: 10)
# Higher values are more secure but slower (each increment doubles time)
# Recommended: 10-12 for production (10 = ~60ms, 12 = ~240ms per operation)
# BCRYPT_ROUNDS=10

# Login request timeout (in seconds, default: 25)
# Maximum time allowed for a login request before returning a timeout error
# This helps prevent HTTP 499 errors by returning a proper response before
# the client or load balancer times out (typically 30 seconds)
# LOGIN_REQUEST_TIMEOUT_SECONDS=25

# Database Configuration
# ⚠️  IMPORTANT: PostgreSQL is REQUIRED for production deployments
# ⚠️  SQLite is only for local development and will NOT persist data in production
#
# =============================================================================
# RAILWAY DEPLOYMENTS (Private Network)
# =============================================================================
# For Railway deployments, use DATABASE_PRIVATE_URL to avoid egress fees:
# DATABASE_PRIVATE_URL is automatically provided by Railway and uses the internal
# private network instead of the public TCP proxy, avoiding egress charges.
DATABASE_PRIVATE_URL=postgresql://username:password@hostname:5432/database
#
# =============================================================================
# VERCEL POSTGRES / NEON DEPLOYMENTS (Connection Pooling)
# =============================================================================
# Vercel Postgres and Neon use pgbouncer for connection pooling.
# The connection string format includes pooling parameters:
#
# POSTGRES_URL - Pooled connection (pgbouncer=true) for queries
# Format: postgres://user:password@host:5432/database?sslmode=require&pgbouncer=true&connect_timeout=15
# Example:
# POSTGRES_URL=postgres://default:ENCRYPTED_PASSWORD@ep-xxxxx.us-east-2.aws.neon.tech/verceldb?sslmode=require&pgbouncer=true&connect_timeout=15
#
# POSTGRES_URL_NON_POOLING - Direct connection (pgbouncer=false) for migrations
# Required for schema changes and DDL operations
# Format: postgres://user:password@host:5432/database?sslmode=require&pgbouncer=false
# Example:
# POSTGRES_URL_NON_POOLING=postgres://default:ENCRYPTED_PASSWORD@ep-xxxxx.us-east-2.aws.neon.tech/verceldb?sslmode=require&pgbouncer=false
#
# Note: Backend uses DATABASE_URL, which should be set to POSTGRES_URL for Vercel/Neon
# DATABASE_URL=${POSTGRES_URL}
#
# =============================================================================
# OTHER PLATFORMS (Render, etc)
# =============================================================================
# For other platforms, set DATABASE_URL to standard PostgreSQL connection string:
DATABASE_URL=postgresql://username:password@hostname:5432/database
#
# Priority: DATABASE_PRIVATE_URL > DATABASE_URL > local default
#
# For local development only, you can comment out both URLs to use SQLite:
# (Uncomment the line below to use SQLite for local dev)
# DATABASE_URL=

# TCP Connection Settings (for PostgreSQL)
# These settings help prevent "SSL error: unexpected eof while reading" errors
# by detecting and handling stale connections before they cause SSL errors.
#
# TCP_KEEPALIVE_ENABLED: Enable TCP keepalive (default: 1 = enabled)
# TCP_KEEPALIVE_IDLE: Seconds before sending keepalive probes (default: 20)
# TCP_KEEPALIVE_INTERVAL: Seconds between keepalive probes (default: 5)
# TCP_KEEPALIVE_COUNT: Number of failed probes before marking connection dead (default: 3)
# TCP_USER_TIMEOUT_MS: Abort if data isn't acknowledged within this time (default: 20000ms)
#
# Total detection time = idle + (interval * count) = 20 + (5 * 3) = 35 seconds
# TCP_KEEPALIVE_ENABLED=1
# TCP_KEEPALIVE_IDLE=20
# TCP_KEEPALIVE_INTERVAL=5
# TCP_KEEPALIVE_COUNT=3
# TCP_USER_TIMEOUT_MS=20000

# =============================================================================
# RAILWAY/RENDER POSTGRES CONNECTION SETTINGS
# =============================================================================
# These settings are optimized for connecting to PostgreSQL from Render to Railway
# or other cross-cloud deployments that may have network latency or IPv6 issues.
#
# =============================================================================
# TOP 3 TIMEOUT FIXES (these address 99% of cloud PostgreSQL timeout issues)
# =============================================================================
#
# 1. DB_CONNECT_TIMEOUT: Connection establishment timeout in seconds (default: 30)
#    - Maximum time to wait for TCP connection and PostgreSQL handshake
#    - Cloud databases need higher timeout (30s) due to network latency and cold starts
#    - This is the #1 cause of timeout errors in cloud deployments
# DB_CONNECT_TIMEOUT=30
#
# 2. JIT (Just-In-Time) Compilation: Automatically disabled via options=-c jit=off
#    - PostgreSQL's JIT compiler causes significant first-query delays
#    - Can cause unexpected timeouts on the first execution of complex queries
#    - The backend automatically sets jit=off in connection options
#
# 3. SSL Mode: Automatically set to 'require' for cloud databases
#    - Cloud databases require SSL for security
#    - Using 'require' ensures encrypted connections work correctly
#    - sslmode=require is the default when DATABASE_URL doesn't specify otherwise
#
# =============================================================================
#
# STATEMENT_TIMEOUT_MS: Query execution timeout in milliseconds (default: 30000)
#   - Applied server-side via PostgreSQL options
#   - Prevents long-running queries from blocking connections
# STATEMENT_TIMEOUT_MS=30000
#
# DB_FORCE_IPV4: Force IPv4 connections (default: true)
#   - Railway/Render sometimes have IPv6 connectivity issues
#   - Set to false only if you have confirmed IPv6 works in your setup
# DB_FORCE_IPV4=true

# Environment (set to "production" or "prod" in production deployments)
# ENVIRONMENT=production

# Server Configuration
PORT=5000

# CORS Settings
FRONTEND_URL=https://hiremebahamas.vercel.app

# OAuth Configuration (Optional - for Google and Apple Sign-In)
# Get Google Client ID from: https://console.cloud.google.com/apis/credentials
# GOOGLE_CLIENT_ID=your_google_client_id_here
# Get Apple Client ID from: https://developer.apple.com/account/resources/identifiers/list/serviceId
# APPLE_CLIENT_ID=com.hiremebahamas.signin

# SonarCloud Configuration (Optional - for code quality analysis)
# Generate a token at: https://sonarcloud.io/account/security/
# Add this as a GitHub repository secret named SONAR_TOKEN at:
# https://github.com/cliffcho242/HireMeBahamas/settings/secrets/actions
# SONAR_TOKEN=your-sonarcloud-token-here

# =============================================================================
# MONITORING & ERROR TRACKING
# =============================================================================

# Sentry Configuration (Error Tracking)
# Get your DSN from: https://sentry.io/ after creating a project
# SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id

# Sentry environment name (automatically set based on ENVIRONMENT if not specified)
# SENTRY_ENVIRONMENT=production

# Redis Configuration (Optional - for caching and sessions)
# Used by Flask-Caching for distributed caching in production
# Falls back to simple in-memory cache if not configured
# REDIS_URL=redis://localhost:6379

# Cache timeout configuration (in seconds)
# CACHE_DEFAULT_TIMEOUT=300
# CACHE_TIMEOUT_JOBS=60
# CACHE_TIMEOUT_POSTS=30
# CACHE_TIMEOUT_USERS=120

# Slow request threshold (in milliseconds)
# Requests exceeding this are logged with warnings
# SLOW_REQUEST_THRESHOLD_MS=3000

# =============================================================================
# MONITORING ENDPOINTS
# =============================================================================
# The following endpoints are available for monitoring:
# - /health         - Quick health check (no DB access)
# - /health/ping    - Ultra-fast ping (returns "pong")
# - /api/health     - Detailed health with database status
# - /metrics        - Prometheus metrics (text format)
# - /api/database/ping - Database keepalive ping

# =============================================================================
# EXTENSION CLEANUP CONFIGURATION
# =============================================================================
# These settings control how the application handles orphaned PostgreSQL
# extensions like pg_stat_statements that can't function on Railway's managed
# PostgreSQL (which lacks shared_preload_libraries access).

# SUPPRESS_EXTENSION_CLEANUP_WARNINGS: Suppress transient connection errors during cleanup
# Set to "true" to hide "Periodic extension cleanup failed" warnings when the database
# connection times out. These warnings are harmless since the cleanup is non-critical.
# Default: true
# SUPPRESS_EXTENSION_CLEANUP_WARNINGS=true

# DISABLE_EXTENSION_CLEANUP: Completely disable periodic extension cleanup
# Set to "true" to stop all periodic extension cleanup attempts.
# The initial cleanup at startup will still run once to set up the dummy view.
# Default: false
# DISABLE_EXTENSION_CLEANUP=false

# CREATE_DUMMY_PG_STAT_STATEMENTS: Create dummy view for Railway monitoring
# Set to "true" to create an empty pg_stat_statements view that satisfies
# Railway's monitoring queries without errors.
# Default: true
# CREATE_DUMMY_PG_STAT_STATEMENTS=true

# DB_EXTENSION_CLEANUP_INTERVAL_SECONDS: How often to run periodic cleanup
# Cleanup runs after this many seconds since the last cleanup.
# Set to a very high value (e.g., 999999999) to effectively disable periodic cleanup.
# Default: 3600 (1 hour)
# DB_EXTENSION_CLEANUP_INTERVAL_SECONDS=3600
